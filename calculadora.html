<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de términos</title>
<style>
:root {
  --accent: #00695c;
  --bg: #fafbfc;
  --fg: #222;
  --border: #e0e0e0;
  --radius: 8px;
}

html, body {
  overscroll-behavior: none; /* evita rebote/elastic scroll */
}

body {
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--fg);
  margin: 32px auto;
  max-width: 600px;
  line-height: 1.6;
  padding: 0 16px 60px; /* margen lateral + aire inferior extra */
}

@media (min-width: 601px) {
  body {
    padding: 0 0 60px; /* en pantallas grandes, sin padding lateral extra */
  }
}

h1 {
  font-size: 1.5rem;
  color: var(--accent);
  margin-bottom: 0.5em;
  font-weight: 600;
}
fieldset {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: #fff;
  padding: 1.5em;
  margin-bottom: 1.5em;
  box-shadow: none;
}
legend {
  font-weight: 600;
  color: var(--accent);
  padding: 0 0.5em;
}
label {
  font-size: 1em;
  font-weight: 500;
  margin-bottom: 0.25em;
  display: block;
}
input, select {
  width: 100%;
  padding: 0.6em;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: #fafbfc;
  font-size: 1em;
  margin-bottom: 1em;
  box-sizing: border-box;
}
input[type="checkbox"] {
  width: auto;
  margin-right: 0.5em;
}
button {
  border: none;
  border-radius: var(--radius);
  padding: 0.7em 1.2em;
  font-size: 1em;
  font-weight: 500;
  background: var(--accent);
  color: #fff;
  cursor: pointer;
  margin-bottom: 0.5em;
  transition: background 0.2s;
}
button.info { background: #0288d1; }
button.warn { background: #fbc02d; color: #222; }
button:active { opacity: 0.9; }

.note {
  background: #e0f2f1;
  border-left: 3px solid var(--accent);
  padding: 1em;
  border-radius: var(--radius);
  margin-bottom: 1em;
}
pre {
  background: #f5f5f5;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1em;
  font-family: ui-monospace, monospace;
  font-size: 0.98em;
  overflow-x: auto;
}
.row {
  display: flex;
  gap: 1em;
  margin-bottom: 1em;
  flex-wrap: wrap;
}
.row > div {
  flex: 1 1 180px;
  min-width: 140px;
}

.actions {
  margin-top: 1em;
  display: flex;
  flex-wrap: nowrap;   /* todos en una sola fila */
  gap: 0.5em;          /* espacio entre botones */
}
.actions button {
  flex: 1 1 0;         /* cada botón ocupa espacio proporcional */
  min-width: 0;        /* permite que se encojan sin romper el layout */
  text-align: center;  /* centra el texto */
}

.muted {
  color: #888;
  font-size: 0.98em;
  margin-bottom: 1.5em;
}
.small {
  font-size: 0.92em;
  color: #666;
}
.danger {
  color: #c62828;
}
</style>

</head>
<body>
  <h1>Calculadora de términos</h1>
  <p class="muted">Esta aplicación calcula los plazos judiciales para cumplir e informar, teniendo en cuenta cierres, fines de semana y festivos en Colombia.</p>

  <fieldset>
    <legend>Datos</legend>
    <div class="row">
      <div>
        <label for="fecha_notif">📆 Fecha de notificación</label>
        <input id="fecha_notif" type="date" />
      </div>
      <div>
        <label for="tipo_notif">📢 Medio</label>
        <select id="tipo_notif">
          <option>Estados</option>
          <option>Estrados</option>
          <option>Ob. Condicional</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="modo_cumpl">🧭 Modo plazo cumplir</label>
        <select id="modo_cumpl">
          <option value="dias" selected>Días</option>
          <option value="meses">Meses</option>
          <option value="fijo">Fecha fija</option>
        </select>
      </div>
      <div id="box_dias">
        <label for="dias_cumpl">📅 Plazo para cumplir (Ddo)</label>
        <input id="dias_cumpl" type="number" value="15" min="0" max="90" />
      </div>
      <div id="box_meses" style="display:none">
        <label for="meses_cumpl">📅 Plazo (meses)</label>
        <input id="meses_cumpl" type="number" value="1" min="0" max="36" />
      </div>
      <div id="box_fijo" style="display:none">
        <label for="fecha_fija">📅 Fecha límite fija</label>
        <input id="fecha_fija" type="date" />
      </div>
    </div>

    <div class="row">
      <div>
        <label for="dias_informe">📅 Plazo para informar (Ddte)</label>
        <input id="dias_informe" type="number" value="30" min="0" max="90" />
      </div>
      <div>
        <label for="fecha_informe">📬 Fecha noticia de incumplimiento</label>
        <input id="fecha_informe" type="date" />
        <div class="small"><label><input id="sin_noticia" type="checkbox"/> Sin noticia de incumplimiento</label></div>
      </div>
    </div>

    <div class="actions">
      <button id="btn_calc" class="primary">Calcular</button>
      <button id="btn_detalle" class="info">Detalle</button>
      <button id="btn_reset" class="warn">Resetear</button>
    </div>
  </fieldset>

  <div id="aviso" class="note" style="display:none"></div>
  <div id="resultado" style="display:none">
    <h2>📌 Resultados</h2>
    <pre id="res_text"></pre>
  </div>
  <div id="detalle" style="display:none">
    <h3>Detalle</h3>
    <pre id="det_ejecutoria"></pre>
    <pre id="det_cumpl"></pre>
    <pre id="det_limite"></pre>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    // ==============================
    // Utilidades de fecha
    // ==============================
    const two = (n)=>String(n).padStart(2,'0');
    const fmt = (d) => `${two(d.getDate())}-${two(d.getMonth()+1)}-${d.getFullYear()}`;
    const ymd = (d) => `${d.getFullYear()}-${two(d.getMonth()+1)}-${two(d.getDate())}`;
    const parseYMD = (s) => { const [y,m,da] = s.split('-').map(Number); return new Date(y, m-1, da); };

    // ==============================
    // Cierres judiciales
    // ==============================
    const cierres_rangos = [
      ["01/01/2020","10/01/2020"],["17/03/2020","30/06/2020"],
      ["13/11/2020",null],["19/12/2020","11/01/2021"],
      ["12/03/2021",null],["06/09/2021",null],
      ["20/12/2021","10/01/2022"],["19/12/2022","11/01/2023"],
      ["12/09/2023","15/09/2023"],["18/10/2023",null],
      ["24/11/2023",null],["27/11/2023",null],
      ["28/11/2023",null],["20/12/2023","14/01/2024"],
      ["19/04/2024",null],["24/04/2024","10/06/2024"],
      ["27/08/2024","28/08/2024"],["18/03/2024",null],
      ["20/12/2024","10/01/2025"]
    ];

    function ddmmyyyyToDate(s){ const [d,m,y]=s.split('/').map(Number); return new Date(y,m-1,d); }
    function buildCierresSet(){
      const set = new Set();
      for(const [iniS, finS] of cierres_rangos){
        const ini = ddmmyyyyToDate(iniS);
        const fin = finS ? ddmmyyyyToDate(finS) : ddmmyyyyToDate(iniS);
        for(let d=new Date(ini); d<=fin; d.setDate(d.getDate()+1)){
          set.add( ymd(d) );
        }
      }
      return set;
    }
    const FECHAS_CIERRE = buildCierresSet();

    // ==============================
    // Festivos Colombia
    // ==============================
    function easterDate(year){ /* Meeus/Jones/Butcher */ 
      const a = year % 19, b = Math.floor(year/100), c = year % 100;
      const d = Math.floor(b/4), e = b % 4, f = Math.floor((b+8)/25);
      const g = Math.floor((b - f + 1)/3), h = (19*a + b - d - g + 15) % 30;
      const i = Math.floor(c/4), k = c % 4;
      const l = (32 + 2*e + 2*i - h - k) % 7;
      const m = Math.floor((a + 11*h + 22*l) / 451);
      const month = Math.floor((h + l - 7*m + 114) / 31);
      const day = 1 + ((h + l - 7*m + 114) % 31);
      return new Date(year, month-1, day);
    }
    function siguienteLunes(d){
      const day = d.getDay();
      if(day === 1) return d;
      const addDays = (8 - day) % 7;
      const nd = new Date(d); nd.setDate(nd.getDate()+addDays); return nd;
    }
    function add(set, date){ set.add( ymd(date) ); }
    function holidaysCOForYears(startY, endY){
      const set = new Set();
      for(let y=startY; y<=endY; y++){
        const pascua = easterDate(y);
        const d = (base, off) => { const nd=new Date(base); nd.setDate(nd.getDate()+off); return nd; };
        // Fijos
        add(set, new Date(y,0,1));
        add(set, new Date(y,4,1));
        add(set, new Date(y,6,20));
        add(set, new Date(y,7,7));
        add(set, new Date(y,11,8));
        add(set, new Date(y,11,25));
        // Emiliani
        add(set, siguienteLunes(new Date(y,0,6)));
        add(set, siguienteLunes(new Date(y,2,19)));
        add(set, siguienteLunes(new Date(y,5,29)));
        add(set, siguienteLunes(new Date(y,7,15)));
        add(set, siguienteLunes(new Date(y,9,12)));
        add(set, siguienteLunes(new Date(y,10,1)));
        add(set, siguienteLunes(new Date(y,10,11)));
        // Pascua
        add(set, d(pascua, -3));
        add(set, d(pascua, -2));
        add(set, siguienteLunes(d(pascua, 39)));
        add(set, siguienteLunes(d(pascua, 60)));
        add(set, siguienteLunes(d(pascua, 68)));
      }
      return set;
    }

    // ==============================
    // Lógica
    // ==============================
    function esHabil(date, festivos){
      const ymdS = ymd(date);
      const day = date.getDay();
      return !FECHAS_CIERRE.has(ymdS) && day>=1 && day<=5 && !festivos.has(ymdS);
    }
    function siguienteHabil(date, festivos){
      const d = new Date(date);
      while(!esHabil(d, festivos)) d.setDate(d.getDate()+1);
      return d;
    }
    function sumarDiasHabilesJudiciales(fechaInicio, cantidad, festivos){
      const logs = [];
      let actual = new Date(fechaInicio); actual.setDate(actual.getDate()+1);
      let cont = 0;
      const diasSemana = ['dom','lun','mar','mié','jue','vie','sáb'];
      while(cont < cantidad){
        let estado = '✅ Hábil judicial', razon = '';
        const isCierre = FECHAS_CIERRE.has( ymd(actual) );
        const isWE = actual.getDay()===0 || actual.getDay()===6;
        const isFest = festivos.has( ymd(actual) );
        if(isCierre){ estado='❌ No cuenta'; razon='Suspensión'; }
        else if(isWE){ estado='❌ No cuenta'; razon='Fin de semana'; }
        else if(isFest){ estado='❌ No cuenta'; razon='Festivo'; }
        else { cont++; }
        logs.push(`${diasSemana[actual.getDay()]} ${fmt(actual)} → ${estado}${razon?` (${razon})`:''}`);
        actual.setDate(actual.getDate()+1);
      }
      const fechaFinal = new Date(actual); fechaFinal.setDate(fechaFinal.getDate()-1);
      return { fechaFinal, logs };
    }
    function sumarMeses(fecha, meses){
      const d = new Date(fecha);
      const y = d.getFullYear(), m = d.getMonth();
      const targetY = y + Math.floor((m + meses) / 12);
      const targetM = (m + meses) % 12;
      const lastDay = new Date(targetY, targetM + 1, 0).getDate();
      const day = Math.min(d.getDate(), lastDay);
      return new Date(targetY, targetM, day);
    }

    // ==============================
    // UI
    // ==============================
    const el = (id) => document.getElementById(id);
    function toggleModo(){
      const v = el('modo_cumpl').value;
      el('box_dias').style.display = (v==='dias')?'' : 'none';
      el('box_meses').style.display = (v==='meses')?'' : 'none';
      el('box_fijo').style.display = (v==='fijo')?'' : 'none';
    }
    el('modo_cumpl').addEventListener('change', toggleModo);
    el('sin_noticia').addEventListener('change', () => {
      el('fecha_informe').disabled = el('sin_noticia').checked;
      if(el('sin_noticia').checked) el('fecha_informe').value = '';
    });
    function reset(){
      el('fecha_notif').value = '';
      el('tipo_notif').value = 'Estados';
      el('modo_cumpl').value = 'dias'; toggleModo();
      el('dias_cumpl').value = 15;
      el('meses_cumpl').value = 1;
      el('fecha_fija').value = '';
      el('dias_informe').value = 30;
      el('fecha_informe').value = '';
      el('sin_noticia').checked = false; el('fecha_informe').disabled = false;
      el('resultado').style.display='none'; el('detalle').style.display='none'; el('aviso').style.display='none';
    }
    el('btn_reset').addEventListener('click', reset);

    // ==============================
    // Cálculo
    // ==============================
    function calcular(mostrarDetalle){
      const notifStr = el('fecha_notif').value;
      if(!notifStr){ alert('Selecciona la fecha de notificación.'); return; }
      const sinNoticia = el('sin_noticia').checked;
      const informeStr = el('fecha_informe').value;
      if(!sinNoticia && !informeStr){ alert('Selecciona la fecha de noticia de incumplimiento o marca "Sin noticia".'); return; }

      const notif = parseYMD(notifStr);
      const anios = Array.from({length:6}, (_,i)=> notif.getFullYear()+i);
      const festivos = holidaysCOForYears(anios[0], anios[anios.length-1]);

      const tipo = el('tipo_notif').value;
      const diasEjecutoria = (tipo === 'Estados') ? 3 : 0;
      const { fechaFinal: fechaEjecutoria, logs: logEjec } = sumarDiasHabilesJudiciales(notif, diasEjecutoria, festivos);

      // Cumplimiento
      let fechaCumpl, logCumpl = [], descriptorCumpl='';
      const modo = el('modo_cumpl').value;
      if(modo === 'dias'){
        const n = Number(el('dias_cumpl').value||0);
        const r = sumarDiasHabilesJudiciales(fechaEjecutoria, n, festivos);
        fechaCumpl = r.fechaFinal; logCumpl = r.logs; descriptorCumpl = `${n} días`;
      } else if(modo === 'meses'){
        const n = Number(el('meses_cumpl').value||0);
        const tentativa = sumarMeses(fechaEjecutoria, n);
        const ajustada = siguienteHabil(tentativa, festivos);
        fechaCumpl = ajustada;
        logCumpl = [
          `Base: ${fmt(fechaEjecutoria)}`,
          `Suma ${n} mes(es) → ${fmt(tentativa)}`,
          (tentativa.getTime()!==ajustada.getTime()?`Ajuste a siguiente hábil → ${fmt(ajustada)}`:'Cae en día hábil (sin ajuste)')
        ];
        descriptorCumpl = `${n} mes(es)`;
      } else {
        const fStr = el('fecha_fija').value;
        if(!fStr){ alert('Debes seleccionar la fecha fija de cumplimiento.'); return; }
        const tentativa = parseYMD(fStr);
        const ajustada = siguienteHabil(tentativa, festivos);
        fechaCumpl = ajustada;
        logCumpl = [
          `Fecha fija elegida: ${fmt(tentativa)}`,
          (tentativa.getTime()!==ajustada.getTime()?`Ajuste a siguiente hábil → ${fmt(ajustada)}`:'Cae en día hábil (sin ajuste)')
        ];
        descriptorCumpl = `Fecha fija (${fmt(tentativa)})`;
      }

      // Informe
      const diasInf = Number(el('dias_informe').value||0);
      const { fechaFinal: fechaLimite, logs: logLim } = sumarDiasHabilesJudiciales(fechaCumpl, diasInf, festivos);

      // Aviso principal
      const hoy = new Date(); const hoyYMD = ymd(hoy);
      const aviso = document.getElementById('aviso');
      let avisoHTML = '';
      if(hoyYMD <= ymd(fechaCumpl)) avisoHTML = '<strong>📌 Este asunto todavía está en término de cumplir.</strong>';
      else if(hoyYMD <= ymd(fechaLimite)) avisoHTML = '<strong>📌 Este asunto todavía está en término para informar.</strong>';
      else avisoHTML = '<strong class="danger">⛔ Este asunto ya venció para cumplir e informar.</strong>';
      aviso.innerHTML = avisoHTML; aviso.style.display='block';

      // Evaluación noticia
      let estado = '▶️ Sin noticia de incumplimiento';
      let textoEntendido = '';
      let informe = null;
      if(!sinNoticia && informeStr){
        informe = parseYMD(informeStr);
        if(informe <= fechaCumpl) estado = '❌ Pretémpore (informó antes de vencer el cumplimiento)';
        else if(informe > fechaLimite) estado = '❌ Extemporáneo (se pasó del plazo)';
        else estado = '✅ Informe oportuno';
        let razon = null;
        if(FECHAS_CIERRE.has( ymd(informe) )) razon='suspensión';
        else if(informe.getDay()===0 || informe.getDay()===6) razon='fin de semana';
        else if(festivos.has( ymd(informe) )) razon='festivo';
        if(razon){
          let entendido = new Date(informe);
          while( FECHAS_CIERRE.has( ymd(entendido) ) || (entendido.getDay()===0 || entendido.getDay()===6) || festivos.has( ymd(entendido) ) ){
            entendido.setDate(entendido.getDate()+1);
          }
          textoEntendido = ` (se entiende entregado el ${fmt(entendido)})`;
        }
      }

      // Resultados
      const res = [
        `🗓️ Notificación: ${fmt(notif)}`,
        `📢 Medio de notificación: ${tipo}`,
        `⏳ Ejecutoria (${diasEjecutoria} días hábiles): ${fmt(fechaEjecutoria)}`,
        `📅 Límite Cumplimiento (Ddo) (${descriptorCumpl}): ${fmt(fechaCumpl)}`,
        `📅 Límite para informar (Ddte) (${diasInf} días): ${fmt(fechaLimite)}`,
        `📬 Noticia recibida el: ${informe?fmt(informe):'N/A'}${textoEntendido}`,
        `📣 Estado de la noticia: ${estado}`
      ].join('\n');
      el('res_text').textContent = res;
      el('resultado').style.display='block';

      if(mostrarDetalle){
        el('det_ejecutoria').textContent = ['Detalle: Ejecutoria', ...logEjec].join('\n');
        el('det_cumpl').textContent = ['Detalle: Cumplimiento', ...logCumpl].join('\n');
        el('det_limite').textContent = ['Detalle: Informe', ...logLim].join('\n');
        el('detalle').style.display='block';
      } else {
        el('detalle').style.display='none';
      }
    }

    document.getElementById('btn_calc').addEventListener('click', ()=>calcular(false));
    document.getElementById('btn_detalle').addEventListener('click', ()=>calcular(true));
    toggleModo();
  });
  </script>
</body>
</html>
